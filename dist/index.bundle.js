(()=>{"use strict";class t{constructor(t=0,e=0,s=0){this.min=t,this.sec=e,this.ms=s}setTime(t,e=0,s=0){this.min=t,this.sec=e,this.ms=s}addTime(e,s=0,i=0){const h=t.toMs(this),r=Math.max(h+t.toMs({min:e,sec:s,ms:i}),0);this.min=t.msToMin(r);const a=t.minToMs(this.min);this.sec=t.msToSec(r-a);const n=t.secToMs(this.sec);this.ms=r-a-n}toString(){return`${this.min}:${this.sec}:${this.ms}`}static toMs(e){return t.minToMs(e.min)+t.secToMs(e.sec)+e.ms}static minToSec(t){return 60*t}static minToMs(t){return 60*t*1e3}static secToMs(t){return 1e3*t}static msToMin(t){return Math.floor(t/6e4)}static msToSec(t){return Math.floor(t/1e3)}static secToMin(t){return Math.floor(t/60)}}class e{constructor(){this.current=(new Date).getTime(),this.previous=this.current,this.delta=0}tick(){this.previous=this.current,this.current=(new Date).getTime(),this.delta=this.current-this.previous}}class s{constructor(t,e,i,h,r){this.root=$(`<div id="${s.id++}" class="target ship" data-first="${t[0]}"\n        style="top: ${i}%; grid-column-start: ${e}; grid-row-start: 1;">\n        <div class="ship__cockpit"></div>\n        <div class="ship__body">\n        <div class="ship__console">\n          <span class="ship__text ship__text--highlight"></span>\n          <span class="ship__text">${t}</span>\n        </div>\n        </div>\n        <div class="ship__engine">\n          <div class="ship__thruster"></div>\n          <div class="ship__thruster"></div>\n          <div class="ship__thruster"></div>\n      </div>`),this.highlight=this.root.find(".ship__text--highlight").first(),this.word=this.root.find(".ship__text--highlight + .ship__text").first(),this.wordText=t,this.start=i,this.column=e,this.goal=h,this.timeToReach=r,this.step=0,this.removed=!1}set onGoalReached(t){this.goalReachedHandler=t}setProgress(t){this.highlight.html(this.wordText.slice(0,t.length)),this.word.html(this.wordText.slice(t.length))}getText(){return this.wordText}goalReached(){this.goalReachedHandler(this),this.remove()}update(t){if(this.removed)return;const e=this.root[0].style.top||"0%";let s=Number.parseInt(e.substr(0,e.length-1));this.goal-s<=0&&this.goalReachedHandler&&this.goalReached();const i=this.step+t/1e3/this.timeToReach;this.step=i,s=this.goal*i,this.root.css({top:`${Math.ceil(s)}%`})}remove(){this.root.remove(),this.removed=!0}}s.id=0;class i{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.get(t)}delete(t){const e=t.getText()[0];return this.get(e)===t&&(this.map.delete(e),!0)}clear(){for(const t of this.map.values())t.remove();this.map.clear()}get size(){return this.map.size}has(t){return this.map.has(t)}values(){return this.map.values()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class h{constructor(){this.clockText=$(".time"),this.targetArea=$(".target-area"),this.gameInput=$(".game-input"),this.modeInfo=$(".mode__info"),this.MAX_TARGETS=4,this.MIN_TIMEREQUIRED=5,this.TARGET_GOAL=90,this.GAMEPLAY_TIME=1,this.targetMap=new i,this.clock=new t;const e=$(".game");e.keydown((t=>{27===t.which&&($("#pauseMenu").toggleClass("menu--hidden"),this.paused=!this.paused)})),e.click((()=>{e.focus()})),e.focus((()=>{$(".game-input").focus()})),$("#playButton").click((()=>{$("#playMenu").toggleClass("menu--hidden"),this.start()})),$("#playAgainButton").click((()=>{$("#gameOverMenu").toggleClass("menu--hidden"),this.start()})),this.gameOver=!0,this.stopped=!0,this.paused=!0,this.gameInput.on("input",this.processTyping.bind(this)),this.step=this.step.bind(this)}setLife(t){this.life=Math.max(0,t),this.lifeCounter.html(this.life),0===this.life&&this.onGameOver()}setScore(t){this.score=t,this.scoreCounter.html(this.score)}setGameInput(t){this.gameInput.val(t)}getGameInput(){return this.gameInput.val()}clearInput(){this.setGameInput(""),this.currentInput=""}blockInput(){this.setGameInput(this.currentInput)}processTyping(t){const e=t.target.value,s=e.slice(-1),i=/[a-zA-Z]/.test(s)||/['\s]/.test(s)&&e.length>0;this.getGameInput().length<this.currentInput.length||this.gameOver||this.paused||this.stopped||!i?this.blockInput():(this.haveTarget()||this.selectTarget(),this.attackTarget())}haveTarget(){return null!==this.target}targetReachedGoal(t){const e=t.getText();this.numTargets-=1,this.freeColumns.push(t.column),this.setLife(this.life-(e.length+5)),e.startsWith(this.currentInput)&&(this.target=null,this.clearInput())}selectTargetFromLetter(t){return this.targetMap.get(t)}selectTarget(){const t=this.selectTargetFromLetter(this.getGameInput().slice(0,1).toLowerCase());t?this.target=t:this.setGameInput(this.currentInput)}attackTarget(){if(!this.target)return;const t=this.target.getText();if(this.getGameInput().toLowerCase()===t)this.clearInput(),this.setScore(this.score+t.length),this.charsTyped+=t.length,this.destroyTarget();else{const e=this.getGameInput().toLowerCase();t.startsWith(e)?(this.currentInput=e,this.target.setProgress(this.currentInput)):this.blockInput()}}destroyTarget(){this.targetMap.delete(this.target),this.freeColumns.push(this.target.column),this.target.remove(),this.target=null,this.numTargets-=1}createTarget(){let t=r();for(;this.targetMap.has(t[0]);)t=r();const e=this.freeColumns.shift(),i=new s(t,e,0,this.TARGET_GOAL,Math.max(this.MIN_TIMEREQUIRED,a(this.MIN_TIMEREQUIRED*t.length)));this.targetArea.append(i.root),i.onGoalReached=this.targetReachedGoal.bind(this),this.targetMap.set(t[0],i)}updateTargets(t){for(const e of this.targetMap.values())e.removed?this.targetMap.delete(e):e.update(t)}update(e){this.clock.addTime(0,0,-1*e),this.clockText.html(this.clock.toString()),0!==t.toMs(this.clock)?(this.numTargets<this.MAX_TARGETS&&(this.numTargets+=1,this.createTarget()),this.updateTargets(e)):this.onGameOver()}onGameOver(){var t,e;this.gameOver=!0,this.paused=!0,this.modeInfo.addClass("mode__info--hidden"),this.gameInput.addClass("game-input--hidden"),$("#menuScore").html(this.score),$("#menuWpm").html((t=this.charsTyped,e=(60*this.GAMEPLAY_TIME-this.clock.sec+.001)/60,Math.ceil(t/5/e))),$("#gameOverMenu").toggleClass("menu--hidden")}start(){this.reset(),this.modeInfo.removeClass("mode__info--hidden"),this.gameInput.removeClass("game-input--hidden"),$(".game-input").focus(),this.paused=this.gameOver=this.stopped=!1,this.frame=requestAnimationFrame(this.step)}reset(){this.timeCounter=new e,this.clock.setTime(this.GAMEPLAY_TIME),this.numTargets=0,this.targetMap.clear(),this.target=null,this.freeColumns=Array.from({length:4},((t,e)=>e+1)),this.clearInput(),this.score=0,this.scoreCounter=$(".score"),this.scoreCounter.html(this.score),this.charsTyped=0,this.life=100,this.lifeCounter=$(".life__points"),this.lifeCounter.html(this.life),this.frame=0,this.gameOver=!1,this.stopped=!1}step(){this.stopped||(this.timeCounter.tick(),this.paused||this.update(this.timeCounter.delta),this.frame=requestAnimationFrame(this.step))}stop(){this.stopped=!0,cancelAnimationFrame(this.frame)}}function r(){return wordList[a(wordList.length)].toLowerCase()}function a(t){return Math.floor(Math.random()*t)}$(document).ready((()=>{!function(){try{new h}catch(t){console.error(t)}}()}))})();